<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
  
      function drawChart() {
        fetch('http://dev.hartcode.com:8811/sensor/list', {mode: 'cors'}).then(function(res) {
	       return res.json();
        }).then(function(sensorjson) {
	  fetch('http://dev.hartcode.com:8811/temp/graph', {mode: 'cors'}).then(function(res) {
	         return res.json();
          }).then(function(json) {

    	  var arraydata = [];
          var titleRow = ['Time']; 
          sensorjson.forEach(function(sensor) {
            var sensorName = sensor.sensorId;
            if ("name" in sensor) {
		sensorName = sensor.name;
            }
            titleRow.push(sensorName);
          });
           arraydata.push(titleRow);
           json.forEach(function (element)  {
           var arrayRow = [new Date(element._id.minute)];
            sensorjson.forEach(function(sensor) {
            element.results.forEach(function(temp) {
                if (sensor.sensorId == temp.sensorId) {
		arrayRow.push(temp.tempInFarenheit);
                }
            });
            });
            arraydata.push(arrayRow);
	    });
           console.log(arraydata);
	    var data = google.visualization.arrayToDataTable(arraydata);
		
          var options = {
            title: 'Temperatures',
            curveType: 'function',
            legend: { position: 'bottom' }
          };

		  var chartdiv = document.createElement("div");
			chartdiv.style="width: 900px; height: 500px";
          document.body.appendChild(chartdiv);			
          var chart = new google.visualization.LineChart(chartdiv);

          chart.draw(data, options);
		  });
		});
		
      }
	  
    </script>
  </head>
  <body>
  </body>
</html>

